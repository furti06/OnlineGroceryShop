{% extends 'admin_base.html' %}
{% load static %}
{% block main %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />

<div class="content-wrapper py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-md-12">
      <div class="card border">
        <div class="card-body">
          <h4 class="card-title mb-2">Change Order Status</h4>
          <p class="text-muted mb-4">Dashboard / <code>order-status</code></p>
          <hr />

          <!-- Order Info -->
          <div class="mb-3">
            <p><strong>Order #:</strong> {{ order.id }}</p>
            <p><strong>Total Price:</strong> TK. {{ order.total }}</p>
            <p><strong>Booking Date:</strong> {{ order.created|date:"d M, Y H:i" }}</p>
            <p><strong>Current Status:</strong> {{ order.get_status_display }}</p>
          </div>

          <!-- Desktop: Horizontal Color-Changing Progress Bar -->
          <div class="d-none d-md-block mb-4">
            <ol class="ProgressBarHorizontal">
              {% for i in orderstatus %}
                <li class="{% if i.0 < order.status %}completed{% elif i.0 == order.status %}current{% else %}upcoming{% endif %}">
                  <span>{{ i.1 }}</span>
                </li>
              {% endfor %}
            </ol>
          </div>

          <!-- Mobile: Vertical Stepper -->
          <div class="d-block d-md-none mb-4">
            <ul class="vertical-stepper list-unstyled">
              {% for i in orderstatus %}
                <li class="{% if i.0 < order.status %}completed{% elif i.0 == order.status %}current{% else %}upcoming{% endif %}">
                  <span class="step-dot"></span>
                  <span class="step-label">{{ i.1 }}</span>
                </li>
              {% endfor %}
            </ul>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex justify-content-start flex-wrap mt-3 gap-2 buttons-wrapper">
            <button class="btn btn-secondary" id="previous" onclick="changestatus('prev')">Previous</button>
            <button class="btn btn-primary" id="advance" onclick="changestatus('next')">Next</button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
function changestatus(direction){
    let orderid = '{{ order.id }}';
    let status = parseInt('{{ order.status }}');

    if(direction === 'prev') status--;
    else status++;

    if(status < 1) status = 1;
    if(status > {{ orderstatus|length }}) status = {{ orderstatus|length }};

    $.get(`/admin-order-track/${orderid}/?status=${status}`, function(){
        location.reload();
    });
}
</script>

<style>
/* ---------- Buttons ---------- */
.buttons-wrapper { margin-top: 15px; }

@media (max-width: 575px) {
  .buttons-wrapper { flex-direction: column; gap: 10px; }
  .buttons-wrapper .btn { width: 100%; }
}

/* ---------- Horizontal Desktop Progress Bar ---------- */
ol.ProgressBarHorizontal {
  display: flex;
  justify-content: space-between;
  list-style: none;
  margin: 2em 1em;
  padding: 0;
  position: relative;
}

ol.ProgressBarHorizontal li {
  position: relative;
  flex: 0 0 auto;
  min-width: 120px;
  text-align: center;
  font-weight: 500;
  color: #666;
  padding-top: 25px; /* space above line for text */
}

/* Step dot */
ol.ProgressBarHorizontal li::after {
  content: '';
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background-color: #ccc; /* upcoming dot */
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
}

ol.ProgressBarHorizontal li.completed::after { background-color: #28a745; }
ol.ProgressBarHorizontal li.current::after { background-color: #00637c; }

/* Connecting line */
ol.ProgressBarHorizontal li::before {
  content: '';
  position: absolute;
  top: 8px; /* center with dot */
  left: 0;
  width: 100%;
  height: 4px;
  background-color: #ccc;
  z-index: 1;
}

ol.ProgressBarHorizontal li:first-child::before { display: none; }
ol.ProgressBarHorizontal li.completed::before { background-color: #28a745; }
ol.ProgressBarHorizontal li.current::before { background-color: #00637c; }

/* ---------- Vertical Mobile Stepper ---------- */
.vertical-stepper li { position: relative; padding-left: 30px; margin-bottom: 20px; }
.vertical-stepper li .step-dot { width: 12px; height: 12px; border-radius: 50%; position: absolute; left: 0; top: 0; background-color: #ccc; }
.vertical-stepper li.completed .step-dot { background-color: #28a745; }
.vertical-stepper li.current .step-dot { background-color: #00637c; }
.vertical-stepper li::before { content: ''; position: absolute; width: 2px; background-color: #ccc; top: 12px; bottom: -20px; left: 5px; z-index: 0; }
.vertical-stepper li.completed::before { background-color: #28a745; }
.vertical-stepper li:last-child::before { display: none; }
.step-label { font-weight: 500; font-size: 0.9rem; display: inline-block; margin-left: 5px; }

</style>

{% endblock %}
